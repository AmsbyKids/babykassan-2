 Steg 1: LÃ¤gg till en funktion som upptÃ¤cker att anvÃ¤ndaren inte har semester
js
Kopiera
Redigera
function detectNoVacation(text) {
  const patterns = [
    'ingen semester',
    'har inga semesterdagar',
    'har inte semester kvar',
    'kan inte ta semester',
    'semester Ã¤r slut',
    'har slut pÃ¥ semester',
    'finns ingen semester kvar'
  ];
  const lower = text.toLowerCase();
  return patterns.some(pattern => lower.includes(pattern));
}
ğŸ§  Steg 2: Modifiera systemPrompt innan du skickar till OpenAI
Leta upp platsen i din kod dÃ¤r du skapar din systemPrompt eller lÃ¤gger till systemmeddelanden till messages/promptMessages. LÃ¤gg in detta direkt efter att du har mottagit anvÃ¤ndarens inmatning (userInput eller liknande):

js
Kopiera
Redigera
if (detectNoVacation(userInput)) {
  systemPrompt += `
AnvÃ¤ndaren har uppgett att hen inte har nÃ¥gra semesterdagar kvar att ta ut.
Det Ã¤r mycket viktigt att du speglar detta i ditt svar.

ğŸ‘‰ Skriv det pÃ¥ ett varmt och empatiskt sÃ¤tt, gÃ¤rna i sektionen ğŸ“Œ Viktigt att tÃ¤nka pÃ¥ eller âœ… Rekommenderad plan.

Exempel pÃ¥ formulering:
â€œEftersom du inte har nÃ¥gra semesterdagar kvar, blir det extra viktigt att planera dina fÃ¶rÃ¤ldradagar klokt ğŸ’›â€

Svara aldrig neutralt eller opersonligt om detta nÃ¤mns. Visa att du lyssnar och fÃ¶rstÃ¥r anvÃ¤ndarens verklighet.
  `;
}
ğŸ’¡ Om du anvÃ¤nder messages = [...] i GPT-4-anropet, sÃ¥ kan du istÃ¤llet lÃ¤gga detta som ett nytt system-meddelande i messages.unshift({ role: "system", content: systemPrompt }).

âœ… Exempel pÃ¥ implementation i queryOpenAI()
HÃ¤r Ã¤r en minimal, sammansatt version:

js
Kopiera
Redigera
async function queryOpenAI(userInput) {
  let systemPrompt = "Du Ã¤r en varm, kunnig och empatisk rÃ¥dgivare som hjÃ¤lper fÃ¶rÃ¤ldrar att planera sin fÃ¶rÃ¤ldraledighet. Svara med struktur: ğŸ“… ğŸ’¸ ğŸ“Œ âœ… ğŸ’¬";

  if (detectNoVacation(userInput)) {
    systemPrompt += `
AnvÃ¤ndaren har uppgett att hen inte har nÃ¥gra semesterdagar kvar att ta ut.
Det Ã¤r mycket viktigt att du speglar detta i ditt svar.

ğŸ‘‰ Skriv det pÃ¥ ett varmt och empatiskt sÃ¤tt, gÃ¤rna i sektionen ğŸ“Œ Viktigt att tÃ¤nka pÃ¥ eller âœ… Rekommenderad plan.

Exempel pÃ¥ formulering:
â€œEftersom du inte har nÃ¥gra semesterdagar kvar, blir det extra viktigt att planera dina fÃ¶rÃ¤ldradagar klokt ğŸ’›â€
`;
  }

  const messages = [
    { role: "system", content: systemPrompt },
    { role: "user", content: userInput }
  ];

  const completion = await openai.chat.completions.create({
    model: "gpt-4",
    messages,
    temperature: 0.7
  });

  return completion.choices[0].message.content;
}